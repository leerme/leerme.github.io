<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>leerme の Blog</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="leerme の Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="leerme の Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="leerme の Blog">
  
    <link rel="alternative" href="/atom.xml" title="leerme の Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="http://ow7iaz7ej.bkt.clouddn.com/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

  
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85415703-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://ow7iaz7ej.bkt.clouddn.com/%E9%92%9F.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">leerme</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">leerme</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://ow7iaz7ej.bkt.clouddn.com/%E9%92%9F.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">leerme</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-App更换图标" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/10/27/App更换图标/" class="article-date">
  	<time datetime="2017-10-27T05:52:27.000Z" itemprop="datePublished">2017-10-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/27/App更换图标/">
        iOS App更换图标
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前段时间查看Apple官方文档，发现了一个新功能就是更换App图标，发现这个功能后，一顿暗喜，装逼的时候又到了! 可以给用户更好的体验、</p>
<p>如下图：<br><img src="http://ow7iaz7ej.bkt.clouddn.com/7%E8%8A%82%E6%97%A5%E5%9B%BE%E6%A0%87.jpg" alt="屏幕截图"></p>
<p>美中不足的是该功能（API）当前只支持<strong>iOS10.3</strong>以上的系统，所以只能当做一项附加功能来进行使用。下面将详细讲解下如何使用代码来实现此功能。</p>
<p>该功能应用的场景<br>1、白天/夜间模式切换，在切换App主色调同时切换App图标。<br>2、各类皮肤主题（淘宝就可换肤），附带App图标一块更换。<br>3、利用App图标表达某种特定功能，如节日，天气。</p>
<a href="https://developer.apple.com/documentation/uikit/uiapplication/2806818-setalternateiconname?preferredLanguage=occ" target="_blank" rel="external">API与文档</a>
<h3 id="API方法"><a href="#API方法" class="headerlink" title="API方法"></a>API方法</h3><p><img src="http://ow7iaz7ej.bkt.clouddn.com/7%E6%96%87%E6%A1%A31.png" alt=""></p>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><p>1、supportsAlternateIcons<br><img src="http://ow7iaz7ej.bkt.clouddn.com/7%E6%96%87%E6%A1%A32.png" alt=""><br>只有系统允许改变你的app图标时该值才为YES。你需要在Info.plist文件中的CFBundleIcons这个键内声明可更换的app图标。</p>
<p>2、alternateIconName<br><img src="http://ow7iaz7ej.bkt.clouddn.com/7%E6%96%87%E6%A1%A33.png" alt=""><br>当系统展示的是你更换后的app图标时，该值即为图标名字（Info.plist中定义的图标名字）。如果展示的是主图标时，这个值为nil。</p>
<p>3、setAlternateIconName:completionHandler:<br><img src="http://ow7iaz7ej.bkt.clouddn.com/7%E6%96%87%E6%A1%A34.png" alt=""><br>alertnateIconName参数：该参数为需要更换的app图标名字，是在你的Info.plist中的CFBundleAlertnateIcons键里定义的。如果你想显示的是用CFBundlePrimaryIcon键所定义的主图标的话，就传入nil。CFBundleAlertnateIcons与CFBundlePrimaryIcon键都是在CFBundleIcons里面定义的。</p>
<p>completionHandler参数：该参数用来处理（更换）结果。当系统尝试更改app的图标后，会将结果数据通过该参数传入并执行（该执行过程是在UIKit所提供的队列执行，并非主队列）。该执行过程会携带一个参数：error。如果更换app图标成功，那么这个参数就是nil。如果更换过程中发生了错误，那么该对象会指明错误信息，并且app的图标保持不变。</p>
<p><img src="http://ow7iaz7ej.bkt.clouddn.com/7%E6%96%87%E6%A1%A35.png" alt=""><br>使用该方法改变app图标为主图标或者可更换的图标。只有在supportsAlternateIcons的返回值为YES时才能更换</p>
<p>你必须在Info.plist文件的CFBundleIcons键里面声明可以更换的app图标（主图标和可更换图标）。如果需要获取关于可更换图标的配置信息，请查阅 <a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009247" target="_blank" rel="external">Information Property List Key</a> 里面有关CFBundleIcons的描述。</p>
<h3 id="可变更App图标的配置方法"><a href="#可变更App图标的配置方法" class="headerlink" title="可变更App图标的配置方法"></a>可变更App图标的配置方法</h3><p><img src="http://ow7iaz7ej.bkt.clouddn.com/7%E6%96%87%E6%A1%A36.png" alt=""><br>Info.plist是个字典，假设为NSDictionary *infoPlist。</p>
<p>1.CFBundleIcons是Info.plist字典里的一个键@”CFBundleIcons”。<br>2.CFBundleIcons对应的value是个字典。<br>3.CFBundleIcons里面能够包含的键有：CFBundlePrimaryIcon、CFBundleAlternateIcons、UINewsstandIcon。</p>
<p>代码展示下这个绕口的结构：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">NSDictionary *infoPlist;</div><div class="line">infoPlist = @&#123;</div><div class="line">               @&quot;CFBundleIcons&quot; : @&#123;</div><div class="line">                                     @&quot;CFBundlePrimaryIcon&quot; : xxx,</div><div class="line">                                     @&quot;CFBundleAlternateIcons&quot; : xxx,</div><div class="line">                                     @&quot;UINewsstandIcon&quot; : xxx</div><div class="line">                                   &#125;</div><div class="line">             &#125;;</div></pre></td></tr></table></figure></p>
<p>1.CFBundleAlternateIcons所对应的value是个字典（iOS中），假设为NSDictionary * alertnateIconsDic。<br>2.alertnateIconsDic的键，都是备用图标的名字，假设为@”newAppIcon”和@”newAppIcon2”。<br>3.@”newAppIcon”的value是个包含CFBundleIconFiles和UIPrerenderedIcon这两个键的字典。<br>4.CFBundleIconFiles的value是字符串或者数组（数组内容也为字符串）。字符串的内容为各尺寸备用图标的名字。<br>5.UIPrerenderedIcon的value是BOOL值。这个键值所代表的作用在iOS7之后（含iOS7）已失效，在iOS6中可渲染app图标为带高亮效果。所以这个值目前我们可以不用关心。<br>代码展示下这个绕口的结构：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@&quot;CFBundleAlternateIcons&quot; : @&#123;</div><div class="line">                               @&quot;newAppIcon&quot; : @&#123;</div><div class="line">                                                 @&quot;CFBundleIconFiles&quot; : @[</div><div class="line">                                                      					  @&quot;newAppIcon&quot;</div><div class="line">                                                    					 ],</div><div class="line">                                                 @&quot;UIPrerenderedIcon&quot; : NO</div><div class="line">                                				&#125;,</div><div class="line">                               @&quot;newAppIcon2&quot; : @&#123;</div><div class="line">                                                 @&quot;CFBundleIconFiles&quot; : @[</div><div class="line">                                                      					  @&quot;newAppIcon2&quot;</div><div class="line">                                                                         ],</div><div class="line">                                                 @&quot;UIPrerenderedIcon&quot; : NO</div><div class="line">                                				 &#125;</div><div class="line">							 &#125;;</div></pre></td></tr></table></figure></p>
<h3 id="实际配置文件-Info-plist"><a href="#实际配置文件-Info-plist" class="headerlink" title="实际配置文件(Info.plist)"></a>实际配置文件(Info.plist)</h3><p>对照着上述的配置文档，我们实际配置完的Info.plist是这样子的：<br><img src="http://ow7iaz7ej.bkt.clouddn.com/7%E9%A1%B9%E7%9B%AE1.png" alt=""><br>拖入对应的App图标：<br><img src="http://ow7iaz7ej.bkt.clouddn.com/7%E9%A1%B9%E7%9B%AE2.png" alt=""><br>在Build Phases -&gt; Copy Bundle Resources加入对应的图片资源<br><img src="http://ow7iaz7ej.bkt.clouddn.com/7%E9%A1%B9%E7%9B%AE3.png" alt=""></p>
<p>然后调用此代码，传入对应的图标名称就可以看到App图标发生了改变啦<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (void)setAppIconWithName:(NSString *)iconName &#123;</div><div class="line">    if (![[UIApplication sharedApplication] supportsAlternateIcons]) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    if ([iconName isEqualToString:@&quot;&quot;]) &#123;</div><div class="line">        iconName = nil;</div><div class="line">    &#125;</div><div class="line">    [[UIApplication sharedApplication] setAlternateIconName:iconName completionHandler:^(NSError * _Nullable error) &#123;</div><div class="line">        if (error) &#123;</div><div class="line">            NSLog(@&quot;更换app图标发生错误了 ： %@&quot;,error);</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-iOS11上的一些问题" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/10/20/iOS11上的一些问题/" class="article-date">
  	<time datetime="2017-10-20T07:42:37.000Z" itemprop="datePublished">2017-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/20/iOS11上的一些问题/">
        项目在iOS11上遇到的小问题
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>iOS11正式版出了这么久了，在忙完新版本开发，写下在iOS11上的一些小问题。</p>
<h3 id="一、App图标不显示"><a href="#一、App图标不显示" class="headerlink" title="一、App图标不显示"></a>一、App图标不显示</h3><p><strong>现象</strong>：升级到iOS11系统下自己的项目桌面app图标不见了<br><img src="http://ow7iaz7ej.bkt.clouddn.com/6%E5%9B%BE3.jpg" alt="图标不见"><br>出现这种情况我还以为自己手动删除了项目 <strong>Images.xcassets</strong>中的<strong>AppIcon</strong>导致没有图标。查看项目和发现这些AppIcon还在，突然发现在Xcode 9中AppIcon有了改变。<br><img src="http://ow7iaz7ej.bkt.clouddn.com/6%E5%9B%BE2.png" alt="AppIcon"><br>发现Xcode 8及之前的版本是可以直接在iTunes Connect上添加App icon。而Xcode 9则是把App icon放置在项目的asset catalog。所以需要把空缺的图标补上，其中一张是1024pt 1x的尺寸。如果没有正确添加iOS App图标，上传到App Store后可能会受到拒绝邮件。<br>心想既然图标变了那么<strong>LaunchImage</strong>呢，果不其然LaunchImage也有小变化为了适配苹果即将售出的iPHone X，这里我们需要在这里添加一张新的尺寸图1125px*2436px。<br><img src="http://ow7iaz7ej.bkt.clouddn.com/6%E5%9B%BE1.png" alt="LaunchImage"><br>那么究竟是什么导致，在iOS 11上面图标消失的呢。查证后发现。</p>
<p><strong>原因</strong>： 使用了CocoaPods的Xcode工程,在iOS11版的手机上AppIcon不显示,原因是CocoaPods的资源编译脚本在iOS11下出了点问题。</p>
<p><strong>解决办法</strong>：<br>1.在Podfile添加脚本修改：<br>1). 在Podfile 添加如下代码.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">post_install do |installer|</div><div class="line">    copy_pods_resources_path = &quot;Pods/Target Support Files/Pods-[工程名]/Pods-[工程名]-resources.sh&quot;</div><div class="line">    string_to_replace = &apos;--compile &quot;$&#123;BUILT_PRODUCTS_DIR&#125;/$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;&quot;&apos;</div><div class="line">    assets_compile_with_app_icon_arguments = &apos;--compile &quot;$&#123;BUILT_PRODUCTS_DIR&#125;/$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;&quot; --app-icon &quot;$&#123;ASSETCATALOG_COMPILER_APPICON_NAME&#125;&quot; --output-partial-info-plist &quot;$&#123;BUILD_DIR&#125;/assetcatalog_generated_info.plist&quot;&apos;</div><div class="line">    text = File.read(copy_pods_resources_path)</div><div class="line">    new_contents = text.gsub(string_to_replace, assets_compile_with_app_icon_arguments)</div><div class="line">    File.open(copy_pods_resources_path, &quot;w&quot;) &#123;|file| file.puts new_contents &#125;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>需要注意的是,将[工程名] 换成自己工程的名称</p>
<p>2).然后运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$pod install</div></pre></td></tr></table></figure>
<p>2.手动修改<br>打开工程目录下:[工程名]/Pods/Target Support Files/Pods/Pods-resources.sh这个文件,替换最后一段代码:</p>
<p>修改前:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">printf &quot;%s\0&quot; &quot;$&#123;XCASSET_FILES[@]&#125;&quot; | xargs -0 xcrun actool --output-format human-readable-text --notices --warnings --platform &quot;$&#123;PLATFORM_NAME&#125;&quot; --minimum-deployment-target &quot;$&#123;!DEPLOYMENT_TARGET_SETTING_NAME&#125;&quot; $&#123;TARGET_DEVICE_ARGS&#125; --compress-pngs --compile &quot;$&#123;BUILT_PRODUCTS_DIR&#125;/$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;&quot;</div><div class="line">fi</div></pre></td></tr></table></figure>
<p>修改后:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">printf &quot;%s\0&quot; &quot;$&#123;XCASSET_FILES[@]&#125;&quot; | xargs -0 xcrun actool --output-format human-readable-text --notices --warnings --platform &quot;$&#123;PLATFORM_NAME&#125;&quot; --minimum-deployment-target &quot;$&#123;!DEPLOYMENT_TARGET_SETTING_NAME&#125;&quot; $&#123;TARGET_DEVICE_ARGS&#125; --compress-pngs --compile &quot;$&#123;BUILT_PRODUCTS_DIR&#125;/$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;&quot; --app-icon &quot;$&#123;ASSETCATALOG_COMPILER_APPICON_NAME&#125;&quot; --output-partial-info-plist &quot;$&#123;BUILD_DIR&#125;/assetcatalog_generated_info.plist&quot;</div><div class="line">fi</div></pre></td></tr></table></figure>
<p>然后重新运行工程即可,配置完成后如果启动后发现还没有图标，现在系统低于iOS 11下的手机运行一次，再在iOS 11上启动就回发现有了。</p>
<p>参考：<a href="https://github.com/CocoaPods/CocoaPods/issues/7003" target="_blank" rel="external">https://github.com/CocoaPods/CocoaPods/issues/7003</a></p>
<h3 id="二、用到相机功能时闪退"><a href="#二、用到相机功能时闪退" class="headerlink" title="二、用到相机功能时闪退"></a>二、用到相机功能时闪退</h3><p><strong>现象</strong>：在用户在手机系统iOS 11里面使用App进行身份证、银行卡ORC识别的时候打开相机发生Crash现象；在iOS 11以下正常。<br><strong>原因</strong>：iOS11下，苹果对相册的权限key做了调整<br>详见：<a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW17" title="[external] [CocoaKeys]" target="_blank" rel="external">CocoaKeys</a><br><strong>解决办法</strong>：在Info.plist里添加以下权限<br><img src="http://ow7iaz7ej.bkt.clouddn.com/6%E5%9B%BE4.png" alt="添加权限"></p>
<h3 id="三、H5和Native交互的时候控制更严格"><a href="#三、H5和Native交互的时候控制更严格" class="headerlink" title="三、H5和Native交互的时候控制更严格"></a>三、H5和Native交互的时候控制更严格</h3><p><strong>现象</strong>：在iOS 11上点击UIWebView加载的H5页面，来与原生App进行交互出现Crash，报错webTread。</p>
<p><strong>原因</strong>：iOS11下，UIWebView与原生交互的时候出现了线程安全问题；控制更加严格。</p>
<p><strong>解决办法</strong>：把调用原生方法的代码放到主线程中运行。<br><img src="http://ow7iaz7ej.bkt.clouddn.com/6%E5%9B%BE5.png" alt="web和Native交互"></p>
<h3 id="四、在Xcode-9中的无线调试"><a href="#四、在Xcode-9中的无线调试" class="headerlink" title="四、在Xcode 9中的无线调试"></a>四、在Xcode 9中的无线调试</h3><p>Xcode 9 里面把很多简单的快捷键给改复杂了，一些插件不支持了。最有利于开发者的地方就是Xcode 9中的无线调试了。<br>苹果诟病最多的产品：数据线<br>心疼的抱住我自己，穿着缝缝补补的衣服，用着自己拼拼接接的数据线<br><img src="http://ow7iaz7ej.bkt.clouddn.com/6%E5%9B%BE7.jpeg" alt="我的数据线"></p>
<p>在Xcode 9中没有这样的烦恼了。</p>
<p>升级到Xcode9.0之后，可以通过Wifi连接iOS或tvOS设备进行无线调试。</p>
<p>要求: Xcode 9.0 以上版本、macOS 10.12.4以上版本、iOS 11.0以上版本, tvOS 11.0以上版本</p>
<p>操作步骤：</p>
<p>打开菜单 Window &gt; Devices and Simulators, 然后在打开的菜单中选择 Devices选项.</p>
<p>通过数据线将您的设备，比如iPhone，连接至Mac电脑.<br>在如下图选择连接的设备，然后在右侧勾选[通过网络连接]复选框.<br><img src="http://ow7iaz7ej.bkt.clouddn.com/6%E5%9B%BE8.png" alt=""><br>Xcode 会和你的设备进行配对. 一旦Xcode和设备配对成功，设备名称的右侧会显示一个网络图标<br><img src="http://ow7iaz7ej.bkt.clouddn.com/6%E5%9B%BE9.png" alt=""><br>最后将设备的数据线从Mac电脑上取出，就可以通过Wifi无线调试了！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-最近学习总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/12/最近学习总结/" class="article-date">
  	<time datetime="2017-09-12T09:19:23.000Z" itemprop="datePublished">2017-09-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/12/最近学习总结/">
        最近学习 JavaScript、node.js 的总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>大前端全栈的热潮下，最近趁工作不太忙，学习了JavaScript，node.js，做一个小小的Demo来记录一下学习的过程。大佬勿喷。小Demo主要功能是记录用户的个人信息，可以对用户的个人信息进行增删改查。前端页面使用HTML +CSS实现，JavaScript控制逻辑，后台使用node.js实现。下面我分三部分总结一下。</p>
<h3 id="一、前端页面"><a href="#一、前端页面" class="headerlink" title="一、前端页面"></a>一、前端页面</h3><h4 id="1-1-页面"><a href="#1-1-页面" class="headerlink" title="1.1 页面"></a>1.1 页面</h4><p>网上传着一句话：不会点HTML+CSS都不敢说自己是程序员，所以写了几个简单的页面，也没有什么技术含量,都是div、span、ul、li、input之类的标签。</p>
<p>下图就是我写的页面！</p>
<p><img src="http://ow7iaz7ej.bkt.clouddn.com/5nocss1.png" alt="首页无CSS"><br><img src="http://ow7iaz7ej.bkt.clouddn.com/5nocss2.png" alt="增加页无CSS"></p>
<h4 id="1-2-CSS"><a href="#1-2-CSS" class="headerlink" title="1.2 CSS"></a>1.2 CSS</h4><p>哈哈是不是太丑了，那肯定不是有三个星期CSS功力的我写的页面，简单的加入点CSS样式之后，这才是我写的。</p>
<p><img src="http://ow7iaz7ej.bkt.clouddn.com/5css1.png" alt="首页CSS"><br><img src="http://ow7iaz7ej.bkt.clouddn.com/5css2.png" alt="增加页CSS"><br>css也就是 margin、padding、width、height等值的配置，当然变成一个高手这些远远不够。</p>
<h3 id="二、前端服务器交互（AJAX）"><a href="#二、前端服务器交互（AJAX）" class="headerlink" title="二、前端服务器交互（AJAX）"></a>二、前端服务器交互（AJAX）</h3><p>只是做前端的相比都知道AJAX，这里说说我只怎么处理各个浏览器兼容，并且很高效<br><strong>问题引出：</strong> 犹豫IE低版本不兼容XMLHttpRequest，所以每次调用AJAX就需要判断是否兼容，然后在调用合适的方法，假如浏览器用AJAX调用100个请求，那就要判断100次兼容。所以非常消耗性能和时间。<br><strong>解决思想：</strong> 第一次执行creatXHR函数的时候，需要兼容判断，在判断完成后，直接把创建AJAX函数赋值(这里举例AJAX函数赋值就是A)给creatXHR函数，那么以后调用creatXHR函数的时候执行的就是AJAX函数赋值（A)，可以省去其中的兼容性判断。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">function creatXHR() &#123;</div><div class="line">        var xhr = null,</div><div class="line">            flag = false,</div><div class="line">            ary = [</div><div class="line">                function () &#123;</div><div class="line">                    return new XMLHttpRequest;</div><div class="line">                &#125;,</div><div class="line">                function () &#123;</div><div class="line">                    return new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</div><div class="line">                &#125;,</div><div class="line">                function () &#123;</div><div class="line">                    return new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;);</div><div class="line">                &#125;,</div><div class="line">                function () &#123;</div><div class="line">                    return new ActiveXObject(&quot;Msxml3.XMLHTTP&quot;);</div><div class="line">                &#125;</div><div class="line">            ];</div><div class="line"></div><div class="line">        for (var i = 0, len = ary.length; i &lt; len; i++) &#123;</div><div class="line">            var curFn = ary[i];</div><div class="line">            try &#123;</div><div class="line">                xhr = curFn();</div><div class="line">                creatXHR = curFn;</div><div class="line">                flag = true;</div><div class="line">                break;</div><div class="line">            &#125; catch (e) &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        if (!flag) &#123;</div><div class="line">            throw new Error(&quot;your browser is not support ajax,please change you broser,try again&quot;);</div><div class="line">        &#125;</div><div class="line">        return xhr;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>AJAX向服务器端发送请求的四个步骤；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var xhr = creatXHR();//1、创建对象</div><div class="line">    xhr.open(_default.type, _default.url, _default.async);//2、请求类型，网址，是否异步</div><div class="line">    xhr.onreadystatechange = function () &#123;</div><div class="line">                &#125;;//3、状态变化监听函数</div><div class="line">    xhr.send(_default.data);//4、发送请求</div></pre></td></tr></table></figure></p>
<p>Demo中处理网络请求核心代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">function ajax(option) &#123;</div><div class="line">        var _default = &#123;</div><div class="line">            url: &quot;&quot;,</div><div class="line">            type: &quot;get&quot;,</div><div class="line">            dataType: &quot;json&quot;,</div><div class="line">            async: true,</div><div class="line">            data: null,</div><div class="line">            getHead: null,</div><div class="line">            success: null</div><div class="line">        &#125;;</div><div class="line">        for (var key in option) &#123;</div><div class="line">            if (option.hasOwnProperty(key)) &#123;</div><div class="line">                _default[key] = option[key];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        //解决缓存问题</div><div class="line">        if (_default.type === &quot;get&quot;) &#123;</div><div class="line">            _default.url.indexOf(&quot;?&quot;) &gt;= 0 ? _default.url += &quot;&amp;&quot; : _default.url += &quot;?&quot;;</div><div class="line">            _default.url += &quot;_=&quot; + Math.random();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        var xhr = creatXHR();</div><div class="line">        xhr.open(_default.type, _default.url, _default.async);</div><div class="line">        xhr.onreadystatechange = function () &#123;</div><div class="line">            if (/^2\d&#123;2&#125;$/.test(xhr.status)) &#123;</div><div class="line">                if (xhr.readyState === 2) &#123;</div><div class="line">                    if (typeof _default.getHead === &quot;function&quot;) &#123;</div><div class="line">                        _default.getHead.call(xhr);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                if (xhr.readyState === 4) &#123;</div><div class="line">                    var val = xhr.responseText;</div><div class="line">                    if (_default.dataType === &quot;json&quot;) &#123;</div><div class="line">                        val = &quot;JSON&quot; in window ? JSON.parse(val) : eval(&quot;(&quot; + val + &quot;)&quot;);</div><div class="line">                    &#125;</div><div class="line">                    _default.success &amp;&amp; _default.success.call(xhr, val);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        xhr.send(_default.data);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h3 id="三、后端（node-js）"><a href="#三、后端（node-js）" class="headerlink" title="三、后端（node.js）"></a>三、后端（node.js）</h3><h4 id="3-1-环境配置"><a href="#3-1-环境配置" class="headerlink" title="3.1 环境配置"></a>3.1 环境配置</h4><p>因为我事先安装好了，所以前两步操作无图（尴尬）<br>第一步:打开终端,输入以下命令安装Homebrew<br>ruby -e “$(curl -fsSL <a href="https://raw.githubusercontent.com/Homebrew/install/master/install" target="_blank" rel="external">https://raw.githubusercontent.com/Homebrew/install/master/install</a>);<br>第二步:安装node,在终端输入以下命令<br>brew install node<br>第三步 查看node安装成功与否<br>node -v<br><img src="http://ow7iaz7ej.bkt.clouddn.com/5nodeVersion.png" alt="查看是否验证安装node"></p>
<h4 id="3-2-node-js的最基本操作"><a href="#3-2-node-js的最基本操作" class="headerlink" title="3.2 node.js的最基本操作"></a>3.2 node.js的最基本操作</h4><p>1.node中提供的三个常用的模块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var http = require(&quot;http&quot;),</div><div class="line">    fs = require(&quot;fs&quot;),</div><div class="line">    url = require(&quot;url&quot;);</div></pre></td></tr></table></figure></p>
<p>2.静态资源文件请求的处理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var server = http.createServer(function (req, res) &#123;</div><div class="line">	// 静态资源文件请求的处理</div><div class="line">	// 数据接口的处理</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>3.服务创建成功执行回调函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">server.listen(8080, function () &#123;</div><div class="line">    //-&gt;当服务创建成功，并且端口号也监听成功之后执行这个回调函数</div><div class="line">    console.log(&quot;server is create success,listening on 8080 port!&quot;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h4 id="3-3-静态资源文件请求的处理"><a href="#3-3-静态资源文件请求的处理" class="headerlink" title="3.3 静态资源文件请求的处理"></a>3.3 静态资源文件请求的处理</h4><p>静态资源文件请求的处理其中重要的点是为了兼容，要对请求文件的MIME Type进行匹配。MIME Type是什么？<br>在浏览器中显示的内容HTML、XML、CSS、PNG、GIF…… 那么，浏览器是如何区分它们，决定什么内容用什么形式来显示？，答案是 MIME Type，也就是该资源的媒体类型。</p>
<p>参考链接：<a href="http://tool.oschina.net/commons" target="_blank" rel="external">http://tool.oschina.net/commons</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">var server = http.createServer(function (req, res) &#123;</div><div class="line">    var urlObj = url.parse(req.url, true),</div><div class="line">        pathname = urlObj.pathname,</div><div class="line">        query = urlObj.query;</div><div class="line">    var reg = /\.(HTML|CSS|JS|ICO)/i;</div><div class="line">    if (reg.test(pathname)) &#123;</div><div class="line">        var suffix = reg.exec(pathname)[1].toUpperCase();</div><div class="line">        var suffixMIME = &quot;text/html&quot;;</div><div class="line">        switch (suffix) &#123;</div><div class="line">            case &quot;CSS&quot;:</div><div class="line">                suffixMIME = &quot;text/css&quot;;</div><div class="line">                break;</div><div class="line">            case &quot;JS&quot;:</div><div class="line">                suffixMIME = &quot;text/javascript&quot;;</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">        try &#123;</div><div class="line">            var conFile = fs.readFileSync(&quot;.&quot; + pathname, &quot;utf-8&quot;);</div><div class="line">            res.writeHead(200, &#123;&apos;content-type&apos;: suffixMIME + &apos;;charset=utf-8;&apos;&#125;);</div><div class="line">            res.end(conFile);</div><div class="line">        &#125; catch (e) &#123;</div><div class="line">            res.writeHead(404, &#123;&apos;content-type&apos;: &apos;text/plain;charset=utf-8;&apos;&#125;);</div><div class="line">            res.end(&quot;file is not found~&quot;);</div><div class="line">        &#125;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">   &#125;);</div></pre></td></tr></table></figure></p>
<h4 id="3-4-API数据接口的处理"><a href="#3-4-API数据接口的处理" class="headerlink" title="3.4 API数据接口的处理"></a>3.4 API数据接口的处理</h4><p>这个是Demo实现了数据的增、删、改、查，所以这里简单的对增，删谈谈。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// 获取服务器端存储的数据</div><div class="line">var customId = null,</div><div class="line">    customPath = &quot;./json/custom.json&quot;,</div><div class="line">    result = &#123;code: 1, msg: &quot;&quot;, data: null&#125;,</div><div class="line">    con = fs.readFileSync(customPath, &quot;utf-8&quot;);</div><div class="line">con.length === 0 ? con = &apos;[]&apos; : null;</div><div class="line">con = JSON.parse(con);</div></pre></td></tr></table></figure>
<p>增加一条客户信息的时候要介绍一下node中requestListener的两个监听方法，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 在接收到数据的时候调用</div><div class="line">req.on(&quot;data&quot;, function (chunk) &#123;</div><div class="line">&lt;!--数据传到服务器不是一次接受到，而是一段一段的数据所以要对数据进行整合 其中参数chunk就是一段一段的数据--&gt;</div><div class="line">&#125;);</div><div class="line">// 在接收数据完成后调用</div><div class="line">req.on(&quot;end&quot;, function () &#123;</div><div class="line">&lt;!--数据传递完之后调用，调用之前要先判断数据是否为空--&gt;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>增加一条客户信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"> // 增加一条客户信息相关代码</div><div class="line">if (pathname === &quot;/addInfo&quot;) &#123;</div><div class="line">        //-&gt;获取客户端通过请求主体传递进来的内容</div><div class="line">        var str = &apos;&apos;;</div><div class="line">        req.on(&quot;data&quot;, function (chunk) &#123;</div><div class="line">            str += chunk;</div><div class="line">        &#125;);</div><div class="line">        req.on(&quot;end&quot;, function () &#123;</div><div class="line">            if (str.length === 0) &#123;</div><div class="line">                res.writeHead(200, &#123;&apos;content-type&apos;: &apos;application/json;charset=utf-8;&apos;&#125;);</div><div class="line">                res.end(JSON.stringify(&#123;</div><div class="line">                    code: 1,</div><div class="line">                    msg: &quot;增加失败,没有传递任何需要增加的信息&quot;</div><div class="line">                &#125;));</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line">            var data = JSON.parse(str);</div><div class="line">            //-&gt;在现有的DATA中追加一个ID:获取CON中最后一项的ID,新的ID是在原有基础上加一即可,如果之前一项都没有,我们这一项的ID就是1</div><div class="line">            data[&quot;id&quot;] = con.length === 0 ? 1 : parseFloat(con[con.length - 1][&quot;id&quot;]) + 1;</div><div class="line">            con.push(data);</div><div class="line">            fs.writeFileSync(customPath, JSON.stringify(con), &quot;utf-8&quot;);</div><div class="line">            res.end(JSON.stringify(&#123;</div><div class="line">                code: 0,</div><div class="line">                msg: &quot;增加成功!&quot;</div><div class="line">            &#125;));</div><div class="line">        &#125;);</div><div class="line">        return;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>根据传入的用户ID删除这个用户信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">//3)根据传递进来的客户ID删除这个客户</div><div class="line">    if (pathname === &quot;/removeInfo&quot;) &#123;</div><div class="line">        customId = query[&quot;id&quot;];</div><div class="line">        var flag = false;</div><div class="line">        for (i = 0; i &lt; con.length; i++) &#123;</div><div class="line">            if (con[i][&quot;id&quot;] == customId) &#123;</div><div class="line">                con.splice(i, 1);</div><div class="line">                flag = true;</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        result.msg = &quot;删除失败&quot;;</div><div class="line">        if (flag) &#123;</div><div class="line">            fs.writeFileSync(customPath, JSON.stringify(con), &quot;utf-8&quot;);</div><div class="line">            result = &#123;</div><div class="line">                code: 0,</div><div class="line">                msg: &quot;删除成功&quot;</div><div class="line">            &#125;;</div><div class="line">        &#125;</div><div class="line">        res.writeHead(200, &#123;&apos;content-type&apos;: &apos;application/json;charset=utf-8;&apos;&#125;);</div><div class="line">        res.end(JSON.stringify(result));</div><div class="line">        return;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h3 id="四、Demo演示"><a href="#四、Demo演示" class="headerlink" title="四、Demo演示"></a>四、Demo演示</h3><p>演示由于服务器中配置的端口号是8080，所以网址的时候需要加上端口号，<br>现在打开页面（不是本地的页面），通过IP访问。已经不是静态页面了。</p>
<p><img src="http://ow7iaz7ej.bkt.clouddn.com/5ip.png" alt="Demo演示"></p>
<p>因为自己平时学习，所以服务器弄在自己电脑上，所以这里的IP就是我电脑的IP地址。<br>在终端输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ifconfig | grep &quot;inet &quot; | grep -v 127.0.0.1</div></pre></td></tr></table></figure></p>
<p>增加操作：<br><img src="http://ow7iaz7ej.bkt.clouddn.com/5add.gif" alt="Demo演示"></p>
<p>删除操作：<br><img src="http://ow7iaz7ej.bkt.clouddn.com/5delete.gif" alt="Demo演示"></p>
<p>项目地址 <strong>麻烦各位大佬给个Star</strong>：<a href="https://github.com/leerme/NodeDemo" target="_blank" rel="external">https://github.com/leerme/NodeDemo</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-算法最长无重复子串" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/07/算法最长无重复子串/" class="article-date">
  	<time datetime="2017-09-07T03:26:35.000Z" itemprop="datePublished">2017-09-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/07/算法最长无重复子串/">
        Longest Substring Without Repeating Characters
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <pre><code>最近在LeetCode上刷题，把自己平时学习的过程记录下来。
</code></pre><h1 id="没有重复字符的最长子串"><a href="#没有重复字符的最长子串" class="headerlink" title="没有重复字符的最长子串"></a>没有重复字符的最长子串</h1><p>Given a string, find the length of the longest substring without repeating characters.</p>
<p>Examples:<br>Given “abcabcbb”, the answer is “abc”, which the length is 3.<br>Given “bbbbb”, the answer is “b”, with the length of 1.<br>Given “pwwkew”, the answer is “wke”, with the length of 3. Note that the answer must be a substring, “pwke” is a subsequence and not a substring.</p>
<p>下面是本人的swift实现方法，思路过于麻烦时间复杂度O(n^3);导致在字符串很长的时候超时，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">class Solution &#123;</div><div class="line">    func lengthOfLongestSubstring(_ s: String) -&gt; Int &#123;</div><div class="line">        var resoult = 0 ;</div><div class="line">        var string = &quot;&quot;;</div><div class="line"></div><div class="line">        for i in 0 ..&lt; s.characters.count&#123;</div><div class="line">            for j in i+1 ... s.characters.count &#123;</div><div class="line">                let indexI = s.index(s.startIndex, offsetBy: i);</div><div class="line">                let indexJ = s.index(s.startIndex, offsetBy: j);</div><div class="line">                string = s.substring(with: indexI..&lt;indexJ);</div><div class="line">                if self.allUnique(string) &#123;</div><div class="line">                    resoult = max(resoult, string.characters.count);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return resoult;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    func allUnique(_ string:String) -&gt; Bool &#123;</div><div class="line">        var set:Set&lt;Character&gt; = [];</div><div class="line">        for i in 0 ..&lt; string.characters.count &#123;</div><div class="line">            </div><div class="line">            let index = string.index(string.startIndex,offsetBy:i)</div><div class="line">            let c = string[index];</div><div class="line">            </div><div class="line">            if set.contains(c) &#123;</div><div class="line">                return false;</div><div class="line">            &#125;</div><div class="line">            set.insert(c);</div><div class="line">        &#125;</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="优化：方法2-Sliding-Window"><a href="#优化：方法2-Sliding-Window" class="headerlink" title="优化：方法2 Sliding Window"></a>优化：方法2 Sliding Window</h3><p>The naive approach is very straightforward. But it is too slow. So how can we optimize it?</p>
<p>In the naive approaches, we repeatedly check a substring to see if it has duplicate character. But it is unnecessary. If a substring s<sub>ij</sub> from index i to j - 1 is already checked to have no duplicate characters. We only need to check if s[j] is already in the substring s<sub>ij</sub>s<br>​ij.<br>To check if a character is already in the substring, we can scan the substring, which leads to an O(n^2) algorithm. But we can do better.<br>By using HashSet as a sliding window, checking if a character in the current can be done in O(1).<br>A sliding window is an abstract concept commonly used in array/string problems. A window is a range of elements in the array/string which usually defined by the start and end indices, i.e. [i, j) (left-closed, right-open). A sliding window is a window “slides” its two boundaries to the certain direction. For example, if we slide [i, j)to the right by 11 element, then it becomes [i+1, j+1)(left-closed, right-open).<br>Back to our problem. We use HashSet to store the characters in current window [i, j)(j = i initially). Then we slide the index jj to the right. If it is not in the HashSet, we slide jj further. Doing so until s[j] is already in the HashSet. At this point, we found the maximum size of substrings without duplicate characters start with index ii. If we do this for all ii, we get our answer.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public class Solution &#123;</div><div class="line">    public int lengthOfLongestSubstring(String s) &#123;</div><div class="line">        int n = s.length();</div><div class="line">        Set&lt;Character&gt; set = new HashSet&lt;&gt;();</div><div class="line">        int ans = 0, i = 0, j = 0;</div><div class="line">        while (i &lt; n &amp;&amp; j &lt; n) &#123;</div><div class="line">            // try to extend the range [i, j]</div><div class="line">            if (!set.contains(s.charAt(j)))&#123;</div><div class="line">                set.add(s.charAt(j++));</div><div class="line">                ans = Math.max(ans, j - i);</div><div class="line">            &#125;</div><div class="line">            else &#123;</div><div class="line">                set.remove(s.charAt(i++));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return ans;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Complexity Analysis</p>
<p>Time complexity : O(2n) = O(n). In the worst case each character will be visited twice by i and j.</p>
<p>Space complexity : O(min(m, n)) Same as the previous approach. We need O(k) space for the sliding window, where k is the size of the Set. The size of the Set is upper bounded by the size of the string n and the size of the charset/alphabet m;</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-iOS事件的传递和响应" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/08/24/iOS事件的传递和响应/" class="article-date">
  	<time datetime="2017-08-24T02:41:45.000Z" itemprop="datePublished">2017-08-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/24/iOS事件的传递和响应/">
        iOS 事件的传递和响应
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <pre><code>谈一谈iOS事件的产生和传递
</code></pre><h1 id="1-事件的产生"><a href="#1-事件的产生" class="headerlink" title="1.事件的产生"></a>1.事件的产生</h1><ul>
<li>发生触摸事件后，系统会将该事件加入到一个由UIApplication管理的事件队列中.</li>
<li>UIApplication会从事件队列中取出最前面的事件，并将事件分发下去以便处理，通常，先发送事件给应用程序的主窗口（keyWindow）。</li>
<li>主窗口会在视图层次结构中找到一个最合适的视图来处理触摸事件，这也是整个事件处理过程的第一步</li>
</ul>
<h1 id="2-事件的传递"><a href="#2-事件的传递" class="headerlink" title="2.事件的传递"></a>2.事件的传递</h1><ol>
<li>首先判断主窗口（keyWindow）自己是否能接受触摸事件</li>
<li>判断触摸点是否在自己身上</li>
<li>子控件数组中从后往前遍历子控件，重复前面的两个步骤（所谓从后往前遍历子控件，就是首先查找子控件数组中最后一个元素，然后执行1、2步骤</li>
<li>view，比如叫做subView，那么会把这个事件交给这个subView，再遍历这个subView的子控件，直至没有更合适的view为止</li>
<li>如果没有符合条件的子控件，那么就认为自己最合适处理这个事件，也就是自己是最合适的view</li>
</ol>
<h3 id="UIView不能接收触摸事件的三种情况："><a href="#UIView不能接收触摸事件的三种情况：" class="headerlink" title="UIView不能接收触摸事件的三种情况："></a>UIView不能接收触摸事件的三种情况：</h3><ul>
<li><strong>不允许交互</strong>：userInteractionEnabled = NO</li>
<li><strong>隐藏</strong>：如果把父控件隐藏，那么子控件也会隐藏，隐藏的控件不能接受事件</li>
<li><strong>透明度</strong>：如果设置一个控件的透明度&lt;0.01，会直接影响子控件的透明度。alpha：0.0~0.01为透明。</li>
</ul>
<p><strong>注 意</strong>:默认UIImageView不能接受触摸事件，因为不允许交互，即userInteractionEnabled = NO，所以如果希望UIImageView可以交互，需要userInteractionEnabled = YES。发生在事件传递的时候。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol>
<li>点击一个UIView或产生一个触摸事件A，这个触摸事件A会被添加到由UIApplication管理的事件队列中（即，首先接收到事件的是UIApplication）。</li>
<li>UIApplication会从事件对列中取出最前面的事件（此处假设为触摸事件A），把事件A传递给应用程序的主窗口（keyWindow）。</li>
<li>窗口会在视图层次结构中找到一个最合适的视图来处理触摸事件。（至此，第一步已完成）</li>
</ol>
<p><img src="http://ow7iaz7ej.bkt.clouddn.com/3iosevent.png" alt="iOS事件示例"></p>
<p>如果想让某个view不能接收事件（或者说，事件传递到某个view那里就断了），那么可以通过刚才提到的三种方式。比如，设置其userInteractionEnabled = NO;那么传递下来的事件就会由该view的父控件处理。<br>例如，不想让蓝色的view接收事件，那么可以设置蓝色的view的userInteractionEnabled = NO;那么点击黄色的view或者蓝色的view所产生的事件，橙色的view就会成为最合适的view。事件都会由橙色的veiw处理。<br>所以，不管视图能不能处理事件，只要点击了视图就都会产生事件，关键看该事件是由谁来处理！也就是说，如果蓝色视图不能处理事件，点击蓝色视图产生的触摸事件不会由被点击的视图（蓝色视图）处理！</p>
<p><strong>注意</strong>：如果设置父控件的透明度或者hidden，会直接影响到子控件的透明度和hidden。如果父控件的透明度为0或者hidden = YES，那么子控件也是不可见的！</p>
<h1 id="3-如何寻找最合适的view"><a href="#3-如何寻找最合适的view" class="headerlink" title="3.如何寻找最合适的view"></a>3.如何寻找最合适的view</h1><pre><code>应用如何找到最合适的控件来处理事件？
</code></pre><ol>
<li>首先判断主窗口（keyWindow）自己是否能接受触摸事件</li>
<li>触摸点是否在自己身上</li>
<li>从后往前遍历子控件，重复前面的两个步骤（首先查找数组中最后一个元素）</li>
<li>如果没有符合条件的子控件，那么就认为自己最合适处理</li>
</ol>
<p><strong>详述：</strong><br>1、主窗口接收到应用程序传递过来的事件后，首先判断自己能否接手触摸事件。如果能，那么在判断触摸点在不在窗口自己身上<br>2、如果触摸点也在窗口身上，那么窗口会从后往前遍历自己的子控件（遍历自己的子控件只是为了寻找出来最合适的view）<br>3、遍历到每一个子控件后，又会重复上面的两个步骤（传递事件给子控件，1.判断子控件能否接受事件，2.点在不在子控件上）<br>4、如此循环遍历子控件，直到找到最合适的view，如果没有更合适的子控件，那么自己就成为最合适的view。<br>找到最合适的view后，就会调用该view的touches方法处理具体的事件。所以，只有找到最合适的view，把事件传递给最合适的view后，才会调用touches方法进行接下来的事件处理。找不到最合适的view，就不会调用touches方法进行事件处理。<br>注意：之所以会采取从后往前遍历子控件的方式寻找最合适的view只是为了做一些循环优化。因为相比较之下，后添加的view在上面，降低循环次数。</p>
<h2 id="3-1-寻找最合适的view底层剖析"><a href="#3-1-寻找最合适的view底层剖析" class="headerlink" title="3.1.寻找最合适的view底层剖析"></a>3.1.寻找最合适的view底层剖析</h2><p>两个重要的方法：<br>hitTest:withEvent:方法<br>pointInside方法</p>
<h3 id="3-1-1-hitTest：withEvent：方法"><a href="#3-1-1-hitTest：withEvent：方法" class="headerlink" title="3.1.1.hitTest：withEvent：方法"></a>3.1.1.hitTest：withEvent：方法</h3><h4 id="什么时候调用？"><a href="#什么时候调用？" class="headerlink" title="什么时候调用？"></a>什么时候调用？</h4><pre><code>只要事件一传递给一个控件,这个控件就会调用他自己的hitTest：withEvent：方法
</code></pre><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><pre><code>寻找并返回最合适的view(能够响应事件的那个最合适的view)
</code></pre><p><strong>注 意：</strong>不管这个控件能不能处理事件，也不管触摸点在不在这个控件上，事件都会先传递给这个控件，随后再调用hitTest:withEvent:方法</p>
<h4 id="拦截事件的处理"><a href="#拦截事件的处理" class="headerlink" title="拦截事件的处理"></a>拦截事件的处理</h4><ul>
<li>正因为hitTest：withEvent：方法可以返回最合适的view，所以可以通过重写hitTest：withEvent：方法，返回指定的view作为最合适的view。</li>
<li>不管点击哪里，最合适的view都是hitTest：withEvent：方法中返回的那个view。</li>
<li>通过重写hitTest：withEvent：，就可以拦截事件的传递过程，想让谁处理事件谁就处理事件。<br>事件传递给谁，就会调用谁的hitTest:withEvent:方法。</li>
</ul>
<p><strong>注 意：如果hitTest:withEvent:方法中返回nil，那么调用该方法的控件本身和其子控件都不是最合适的view，也就是在自己身上没有找到更合适的view。那么最合适的view就是该控件的父控件。<br>所以事件的传递顺序是这样的：<br>　　产生触摸事件-&gt;UIApplication事件队列-&gt;[UIWindow hitTest:withEvent:]-&gt;返回更合适的view-&gt;[子控件 hitTest:withEvent:]-&gt;返回最合适的view</strong><br>　　<br>事件传递给窗口或控件的后，就调用hitTest:withEvent:方法寻找更合适的view。所以是，先传递事件，再根据事件在自己身上找更合适的view。<br>不管子控件是不是最合适的view，系统默认都要先把事件传递给子控件，经过子控件调用自己的hitTest:withEvent:方法验证后才知道有没有更合适的view。即便父控件是最合适的view了，子控件的hitTest:withEvent:方法还是会调用，不然怎么知道有没有更合适的！即，如果确定最终父控件是最合适的view，那么该父控件的子控件的hitTest:withEvent:方法也是会被调用的。<br>技巧：想让谁成为最合适的view就重写谁自己的父控件的hitTest:withEvent:方法返回指定的子控件，或者重写自己的hitTest:withEvent:方法 return self。但是，建议在父控件的hitTest:withEvent:中返回子控件作为最合适的view！</p>
<p>原因在于在自己的hitTest:withEvent:方法中返回自己有时候会出现问题。因为会存在这么一种情况：当遍历子控件时，如果触摸点不在子控件A自己身上而是在子控件B身上，还要要求返回子控件A作为最合适的view，采用返回自己的方法可能会导致还没有来得及遍历A自己，就有可能已经遍历了点真正所在的view，也就是B。这就导致了返回的不是自己而是触摸点真正所在的view。所以还是建议在父控件的hitTest:withEvent:中返回子控件作为最合适的view！<br>例如：whiteView有redView和greenView两个子控件。redView先添加，greenView后添加。如果要求无论点击那里都要让redView作为最合适的view（把事件交给redView来处理）那么只能在whiteView的hitTest:withEvent:方法中return self.subViews[0];这种情况下在redView的hitTest:withEvent:方法中return self;是不好使的！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">// 这里redView是whiteView的第0个子控件</div><div class="line">#import &quot;redView.h&quot;</div><div class="line"></div><div class="line">@implementation redView</div><div class="line">- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event&#123; </div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event&#123; </div><div class="line">    NSLog(@&quot;red-touch&quot;);</div><div class="line">&#125;@end</div><div class="line">// 或者</div><div class="line">#import &quot;whiteView.h&quot;</div><div class="line"></div><div class="line">@implementation whiteView</div><div class="line">- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event&#123; </div><div class="line">    return self.subviews[0];</div><div class="line">&#125;</div><div class="line">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event&#123; </div><div class="line">    NSLog(@&quot;white-touch&quot;);</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>hit:withEvent:方法底层会调用pointInside:withEvent:方法判断点在不在方法调用者的坐标系上。</p>
<h3 id="3-1-2-pointInside-withEvent-方法"><a href="#3-1-2-pointInside-withEvent-方法" class="headerlink" title="3.1.2.pointInside:withEvent:方法"></a>3.1.2.pointInside:withEvent:方法</h3><p>pointInside:withEvent:方法判断点在不在当前view上（方法调用者的坐标系上）如果返回YES，代表点在方法调用者的坐标系上;返回NO代表点不在方法调用者的坐标系上，那么方法调用者也就不能处理事件。</p>
<h1 id="4事件的响应"><a href="#4事件的响应" class="headerlink" title="4事件的响应"></a>4事件的响应</h1><h2 id="4-1-触摸事件处理的整体过程"><a href="#4-1-触摸事件处理的整体过程" class="headerlink" title="4.1.触摸事件处理的整体过程"></a>4.1.触摸事件处理的整体过程</h2><p>1&gt;用户点击屏幕后产生的一个触摸事件，经过一系列的传递过程后，会找到最合适的视图控件来处理这个事件2&gt;找到最合适的视图控件后，就会调用控件的touches方法来作具体的事件处理touchesBegan…touchesMoved…touchedEnded…3&gt;这些touches方法的默认做法是将事件顺着响应者链条向上传递（也就是touch方法默认不处理事件，只传递事件），将事件交给上一个响应者进行处理</p>
<h2 id="4-2-响应者链条示意图"><a href="#4-2-响应者链条示意图" class="headerlink" title="4.2.响应者链条示意图"></a>4.2.响应者链条示意图</h2><p><strong>响应者链条</strong>：在iOS程序中无论是最后面的UIWindow还是最前面的某个按钮，它们的摆放是有前后关系的，一个控件可以放到另一个控件上面或下面，那么用户点击某个控件时是触发上面的控件还是下面的控件呢，这种先后关系构成一个链条就叫“响应者链”。也可以说，响应者链是由多个响应者对象连接起来的链条。</p>
<p><strong>响应者对象</strong>：能处理事件的对象，也就是继承自UIResponder的对象<br><strong>作用</strong>：能很清楚的看见每个响应者之间的联系，并且可以让一个事件多个对象处理。</p>
<h4 id="如何判断上一个响应者"><a href="#如何判断上一个响应者" class="headerlink" title="如何判断上一个响应者"></a>如何判断上一个响应者</h4><ol>
<li>如果当前这个view是控制器的view,那么控制器就是上一个响应者</li>
<li>如果当前这个view不是控制器的view,那么父控件就是上一个响应者<br>响应者链的事件传递过程:</li>
</ol>
<h4 id="事件处理的整个流程总结："><a href="#事件处理的整个流程总结：" class="headerlink" title="事件处理的整个流程总结："></a>事件处理的整个流程总结：</h4><ol>
<li>触摸屏幕产生触摸事件后，触摸事件会被添加到由UIApplication管理的事件队列中（即，首先接收到事件的是UIApplication）。</li>
<li>UIApplication会从事件队列中取出最前面的事件，把事件传递给应用程序的主窗口（keyWindow）。</li>
<li>主窗口会在视图层次结构中找到一个最合适的视图来处理触摸事件。（至此，第一步已完成)</li>
<li>最合适的view会调用自己的touches方法处理事件</li>
<li>touches默认做法是把事件顺着响应者链条向上抛。</li>
</ol>
<h4 id="事件的传递与响应："><a href="#事件的传递与响应：" class="headerlink" title="事件的传递与响应："></a>事件的传递与响应：</h4><ol>
<li><p>当一个事件发生后，事件会从父控件传给子控件，也就是说由UIApplication -&gt; UIWindow -&gt; UIView -&gt; initial view,以上就是事件的传递，也就是寻找最合适的view的过程。</p>
</li>
<li><p>接下来是事件的响应。首先看initial view能否处理这个事件，如果不能则会将事件传递给其上级视图（inital view的superView）；如果上级视图仍然无法处理则会继续往上传递；一直传递到视图控制器view controller，首先判断视图控制器的根视图view是否能处理此事件；如果不能则接着判断该视图控制器能否处理此事件，如果还是不能则继续向上传 递；（对于第二个图视图控制器本身还在另一个视图控制器中，则继续交给父视图控制器的根视图，如果根视图不能处理则交给父视图控制器处理）；一直到 window，如果window还是不能处理此事件则继续交给application处理，如果最后application还是不能处理此事件则将其丢弃</p>
</li>
<li><p>在事件的响应中，如果某个控件实现了touches…方法，则这个事件将由该控件来接受，如果调用了[supertouches….];就会将事件顺着响应者链条往上传递，传递给上一个响应者；接着就会调用上一个响应者的touches….方法</p>
</li>
</ol>
<h4 id="如何做到一个事件多个对象处理："><a href="#如何做到一个事件多个对象处理：" class="headerlink" title="如何做到一个事件多个对象处理："></a>如何做到一个事件多个对象处理：</h4><p>因为系统默认做法是把事件上抛给父控件，所以可以通过重写自己的touches方法和父控件的touches方法来达到一个事件多个对象处理的目的。</p>
<figure class="highlight plain"><figcaption><span>(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event&#123; </span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 1.自己先处理事件...</div><div class="line">NSLog(@&quot;do somthing...&quot;);</div><div class="line">// 2.再调用系统的默认做法，再把事件交给上一个响应者处理</div><div class="line">[super touchesBegan:touches withEvent:event]; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="事件的传递和响应的区别："><a href="#事件的传递和响应的区别：" class="headerlink" title="事件的传递和响应的区别："></a>事件的传递和响应的区别：</h4><p>事件的传递是从上到下（父控件到子控件），事件的响应是从下到上（顺着响应者链条向上传递：子控件到父控件。</p>
<p>参考链接：<a href="http://www.jianshu.com/p/2e074db792ba" target="_blank" rel="external">http://www.jianshu.com/p/2e074db792ba</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-ReactNative" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/27/ReactNative/" class="article-date">
  	<time datetime="2017-06-27T05:52:15.000Z" itemprop="datePublished">2017-06-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/27/ReactNative/">
        iOS React/RCTBundleURLProvider.h&#39; file not found
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <pre><code>学习React Native使用react-native init 项目名称之后运行项目，编译就报React/RCTBundleURLProvider.h&apos; file not found怎么办。
</code></pre><h3 id="下面先看一下实现效果"><a href="#下面先看一下实现效果" class="headerlink" title="下面先看一下实现效果."></a>下面先看一下实现效果.</h3><div align="center"><br><img src="http://ow7iaz7ej.bkt.clouddn.com/2reactnative.png" alt="屏幕截图"><br></div>

<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>原来是新版本有问题<br>新建项目指定版本：<br>用–version参数创建指定版本的项目。例如react-native init ceshi –version 0.44.3注意版本号必须精确到两个小数点。<br>项目创建好之后：执行：react-native run-ios</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-右滑返回" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/03/23/右滑返回/" class="article-date">
  	<time datetime="2017-03-23T05:52:15.000Z" itemprop="datePublished">2017-03-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/23/右滑返回/">
        iOS | 右滑返回
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>苹果系统自带的右滑返回方便方便人们更好的使用APP，前几天老总就提了这个需求，今天结合自己项目谈一谈，产品设计的需求诡异，打破了系统默认的页面跳转规则（Push、Pop），各个页面神跳转(好了不吐槽了),需要自己自定义NavigationController从而导致系统自带的右滑返回失效。</p>
<h3 id="下面先看一下实现效果"><a href="#下面先看一下实现效果" class="headerlink" title="下面先看一下实现效果."></a>下面先看一下实现效果.</h3><div align="center"><br><img src="http://ow7iaz7ej.bkt.clouddn.com/1rightSlide.gif" alt="屏幕截图"><br></div>

<h3 id="效果还不错吧-直接上代码"><a href="#效果还不错吧-直接上代码" class="headerlink" title="效果还不错吧,直接上代码"></a>效果还不错吧,直接上代码</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"LYNavigationController.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LYNavigationController</span> () &lt;<span class="title">UIGestureRecognizerDelegate</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LYNavigationController</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad&#123;</div><div class="line">[<span class="keyword">super</span> viewDidLoad];</div><div class="line"><span class="comment">//  这句很核心 稍后讲解</span></div><div class="line"><span class="keyword">id</span> target = <span class="keyword">self</span>.interactivePopGestureRecognizer.delegate;</div><div class="line"><span class="comment">//  这句很核心 稍后讲解</span></div><div class="line">SEL handler = <span class="built_in">NSSelectorFromString</span>(<span class="string">@"handleNavigationTransition:"</span>);</div><div class="line"><span class="comment">//  获取添加系统边缘触发手势的View</span></div><div class="line"><span class="built_in">UIView</span> *targetView = <span class="keyword">self</span>.interactivePopGestureRecognizer.view;</div><div class="line"></div><div class="line"><span class="comment">//  创建pan手势 作用范围是全屏</span></div><div class="line"><span class="built_in">UIPanGestureRecognizer</span> * fullScreenGes = [[<span class="built_in">UIPanGestureRecognizer</span> alloc]initWithTarget:target action:handler];</div><div class="line">fullScreenGes.delegate = <span class="keyword">self</span>;</div><div class="line">[targetView addGestureRecognizer:fullScreenGes];</div><div class="line"></div><div class="line"><span class="comment">// 关闭边缘触发手势 防止和原有边缘手势冲突</span></div><div class="line">[<span class="keyword">self</span>.interactivePopGestureRecognizer setEnabled:<span class="literal">NO</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//  防止导航控制器只有一个rootViewcontroller时触发手势</span></div><div class="line">- (<span class="built_in">BOOL</span>)gestureRecognizerShouldBegin:(<span class="built_in">UIPanGestureRecognizer</span> *)gestureRecognizer &#123;</div><div class="line"><span class="comment">//解决与左滑手势冲突</span></div><div class="line"><span class="built_in">CGPoint</span> translation = [gestureRecognizer translationInView:gestureRecognizer.view];</div><div class="line"><span class="keyword">if</span> (translation.x &lt;= <span class="number">0</span>) &#123;</div><div class="line"><span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> <span class="keyword">self</span>.childViewControllers.count == <span class="number">1</span> ? <span class="literal">NO</span> : <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div></pre></td></tr></table></figure>
<p>在实现之前,先推测一下苹果实现pop的大概思路.首先,需要在一个合适的view上添加边缘手势,其次,针对这个手势必然要实现一个方法响应该事件.当然,根据苹果一贯代码风格,处理该事件很可能交给另一个专门的类去处理.</p>
<p>假如以上推测成立,只要获得那个专门处理事件的类和方法,实现全屏pop效果就很简单了.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">(lldb) pclass [<span class="keyword">self</span> interactivePopGestureRecognizer]</div><div class="line"><span class="comment">// 信息-&gt;1</span></div><div class="line"><span class="built_in">UIScreenEdgePanGestureRecognizer</span></div><div class="line">| <span class="built_in">UIPanGestureRecognizer</span></div><div class="line">|    | <span class="built_in">UIGestureRecognizer</span></div><div class="line">|    |    | <span class="built_in">NSObject</span></div><div class="line">(lldb) pclass [<span class="keyword">self</span> interactivePopGestureRecognizer].delegate</div><div class="line"><span class="comment">// 信息-&gt;2</span></div><div class="line">_UINavigationInteractiveTransition</div><div class="line">| _UINavigationInteractiveTransitionBase</div><div class="line">|    | <span class="built_in">UIPercentDrivenInteractiveTransition</span></div><div class="line">|    |    | <span class="built_in">NSObject</span></div><div class="line">(lldb) po [<span class="keyword">self</span> interactivePopGestureRecognizer]</div><div class="line"><span class="comment">// 信息-&gt;3</span></div><div class="line">&lt;<span class="built_in">UIScreenEdgePanGestureRecognizer</span>: <span class="number">0x7fab1243be00</span>; state = Possible; enabled = <span class="literal">NO</span>; delaysTouchesBegan = <span class="literal">YES</span>; view = &lt;<span class="built_in">UILayoutContainerView</span> <span class="number">0x7fab126a4a60</span>&gt;; target= &lt;(action=handleNavigationTransition:, target=&lt;_UINavigationInteractiveTransition <span class="number">0x7fab1243b850</span>&gt;)&gt;&gt;</div><div class="line"></div><div class="line">(lldb) po [<span class="keyword">self</span> interactivePopGestureRecognizer].delegate</div><div class="line"><span class="comment">// 信息-&gt;4</span></div><div class="line">&lt;_UINavigationInteractiveTransition: <span class="number">0x7fab1243b850</span>&gt;</div><div class="line"></div><div class="line">(lldb)</div></pre></td></tr></table></figure>
<p>从信息1中,可以知道interactivePopGestureRecognizer属性并不是UIGestureRecognizer类型的对象,而是其子类UIPanGestureRecognizer的子类UIScreenEdgePanGestureRecognizer类型的对象.</p>
<p>UIScreenEdgePanGestureRecognizer是边缘触发手势,在系统中公有API,里面只有一个edges属性,用来设置具体边缘有效,如左边缘.具体可以参考官方API.</p>
<p>在信息3中,可以看到<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">target= (action=handleNavigationTransition:, target=&lt;_UINavigationInteractiveTransition x7fab1243b850&gt;)</div></pre></td></tr></table></figure><br>这样一条信息,里面包含了target和action.看到这是不是很兴奋?iOS开发者再也属性不过的目标-动作模式了.</p>
<p>到这里,已经可以确定苹果的实现方式是通过边缘触发手势处理pop的.这里target是私有的,如何获得呢?于是,网上很多人开始使用runtime来获得一些私有的方法.笔者一般不愿在正式上线的项目中使用runtime获得私有API,虽然不一定会被苹果拒接,但是会有一定风险</p>
<p>难道有没不用runtime的好方法?</p>
<p>先别着急,继续看信息2和4, interactivePopGestureRecognizer的代理是_UINavigationInteractiveTransition,看类名可以想到该类和交互转场相关.分析到这里,基本上可以推测出苹果是通过代理将事件处理委托给了_UINavigationInteractiveTransition对象.</p>
<p>在信息3中,可以看到target=<_uinavigationinteractivetransition 0x7fab1243b850="">的地址是0x7fab1243b850,信息4中<_uinavigationinteractivetransition: 0x7fab1243b850="">的地址也是0x7fab1243b850.</_uinavigationinteractivetransition:></_uinavigationinteractivetransition></p>
<p>由以上分析,可以确定苹果的实现方式是将处理边缘触发的事件的任务委托给了_UINavigationInteractiveTransition,在_UINavigationInteractiveTransition中有处理该事件的方法handleNavigationTransition:.</p>
<h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> target = <span class="keyword">self</span>.interactivePopGestureRecognizer.delegate;</div></pre></td></tr></table></figure>
<p>这句代码目的是获取事件处理对象.以便自己添加的手势可以把事件处理委托给它.<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SEL handler = <span class="built_in">NSSelectorFromString</span>(<span class="string">@"handleNavigationTransition:"</span>);</div></pre></td></tr></table></figure><br>这句就是获取委托对象里的处理方法.<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UIPanGestureRecognizer</span> * fullScreenGes = [[<span class="built_in">UIPanGestureRecognizer</span> alloc]initWithTarget:target action:handler];</div><div class="line">fullScreenGes.delegate = <span class="keyword">self</span>;</div><div class="line">[targetView addGestureRecognizer:fullScreenGes];</div></pre></td></tr></table></figure><br>这几句就是添加自己的全屏手势,通过目标-动作模式把任务交给了系统委托对象处理.</p>
<h3 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h3><p>如果需要自定制导航时,实现是写在UINavigationController子类中,比较方便.如果不需要,可以单独写一个分类.这里写在GLNavigationController中,其中GLNavigationController.h继承自UINavigationController.</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2017 leerme
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>